<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MSA í”„ë¡œì íŠ¸ - The Cafe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        .navbar-brand { font-weight: bold; }
        .nav-link { color: #333; }
        .nav-link:hover { color: #0d6efd; }

        .hero-section {
            background-image:
                    linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
                    url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=1920&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .btn-coffee {
            background-color: #6f4e37;
            color: white;
            font-weight: bold;
            border: none;
        }
        .btn-coffee:hover {
            background-color: #5a3f2d;
            color: white;
        }

        .card {
            border: none;
            transition: transform .2s, box-shadow .2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,.1);
        }
        .card-icon {
            font-size: 3rem;
            color: #6f4e37;
        }
    </style>

</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="bi bi-cup-hot-fill"></i> The MSA Cafe
        </a>
        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">

            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="/menus" id="menuLink">ë©”ë‰´ ê´€ë¦¬</a></li>
                <li class="nav-item"><a class="nav-link" href="/orders" id="orderLink">ì£¼ë¬¸</a></li>
                <li class="nav-item"><a class="nav-link" href="/list" id="listLink">ê²Œì‹œíŒ</a></li>
                <li class="nav-item"><a class="nav-link" href="/stocks" id="stockLink">ì¬ê³ </a></li>
                <li class="nav-item"><a class="nav-link" href="/dashboard" id="dashLink">ì£¼ë¬¸ í˜„í™©</a></li>
                <li class="nav-item"><a class="nav-link" href="/customers" id="customerLink">ê³ ê° ê´€ë¦¬</a></li>
            </ul>

            <ul class="navbar-nav">
                <li class="nav-item" id="loginNav"><a class="nav-link" href="/login">ë¡œê·¸ì¸</a></li>
                <li class="nav-item" id="registerNav"><a class="nav-link" href="/register">íšŒì›ê°€ì…</a></li>

                <li class="nav-item d-none" id="userNav"><span class="nav-link" id="username"></span></li>
                <li class="nav-item d-none" id="changePasswordNav"><a class="nav-link" href="/changepassword">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a></li>
                <li class="nav-item d-none" id="logoutNav"><a class="nav-link" href="#" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>

        </div>
    </div>
</nav>

<!-- ë©”ì¸ Hero -->
<div class="hero-section text-center">
    <div class="container">
        <h1 class="display-3 fw-bold">The MSA Cafe</h1>
        <p class="lead fs-4">ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê¸°ë°˜ ì¹´í˜ ì£¼ë¬¸ ì‹œìŠ¤í…œ</p>

        <a href="/orders" class="btn btn-coffee btn-lg m-2" id="heroOrderBtn">
            <i class="bi bi-cart-check"></i> ì§€ê¸ˆ ì£¼ë¬¸í•˜ê¸°
        </a>

        <!-- ê´€ë¦¬ì ë²„íŠ¼ -->
        <a href="#" class="btn btn-outline-light btn-lg m-2" onclick="checkAdminAccess('/menus')">
            <i class="bi bi-book"></i> ë©”ë‰´ ê´€ë¦¬
        </a>
    </div>
</div>

<!-- ğŸ”¥ ì£¼ìš” ê¸°ëŠ¥ ì¹´ë“œ ì„¹ì…˜ (ìš”ì²­í•œ ë¶€ë¶„ ë³µì› + ê´€ë¦¬ì ì²´í¬ ì ìš©) -->
<div class="container mt-5 mb-5">
    <h2 class="text-center mb-4">ì£¼ìš” ê¸°ëŠ¥</h2>
    <div class="row g-4">

        <div class="col-md-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <div class="card-icon mb-3"><i class="bi bi-journal-plus"></i></div>
                    <h5 class="card-title">ë™ì  ë©”ë‰´ ê´€ë¦¬</h5>
                    <p class="card-text">ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ë‰´ì™€ ì˜µì…˜ì„ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•©ë‹ˆë‹¤.</p>
                    <button class="btn btn-coffee" onclick="checkAdminAccess('/menus')">ë©”ë‰´ ê´€ë¦¬ë¡œ ì´ë™</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <div class="card-icon mb-3"><i class="bi bi-bar-chart-line-fill"></i></div>
                    <h5 class="card-title">ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™©</h5>
                    <p class="card-text no-wrap-text">10ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ì£¼ë¬¸ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.</p>
                    <button class="btn btn-coffee" onclick="checkAdminAccess('/dashboard')">ëŒ€ì‹œë³´ë“œë¡œ ì´ë™</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100 text-center shadow-sm">
                <div class="card-body">
                    <div class="card-icon mb-3"><i class="bi bi-box-seam-fill"></i></div>
                    <h5 class="card-title">ë¶„ì‚° ì¬ê³  ê´€ë¦¬</h5>
                    <p class="card-text">ì£¼ë¬¸ ì‹œ Feign Clientë¥¼ í†µí•´ ì¬ê³ ë¥¼ ì°¨ê°í•©ë‹ˆë‹¤.</p>
                    <button class="btn btn-coffee" onclick="checkAdminAccess('/stocks')">ì¬ê³  ê´€ë¦¬ë¡œ ì´ë™</button>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ëª¨ë‹¬ (ë¡œê·¸ì¸/ê´€ë¦¬ì ê³µìš©) -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">ì•Œë¦¼</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body" id="modalMessage"></div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button class="btn btn-primary" id="goToLogin">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</button>
            </div>

        </div>
    </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /* -------------------------------
       ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
    --------------------------------*/
    function checkLoginStatus() {
        const token = localStorage.getItem("token");
        const username = localStorage.getItem("username");
        const role = localStorage.getItem("role");

        if (token && username) {
            document.getElementById("loginNav").classList.add("d-none");
            document.getElementById("registerNav").classList.add("d-none");
            document.getElementById("userNav").classList.remove("d-none");
            document.getElementById("logoutNav").classList.remove("d-none");
            document.getElementById("changePasswordNav").classList.remove("d-none");

            document.getElementById("username").textContent = `${username} (${role})`;
        } else {
            document.getElementById("loginNav").classList.remove("d-none");
            document.getElementById("registerNav").classList.remove("d-none");
            document.getElementById("userNav").classList.add("d-none");
            document.getElementById("logoutNav").classList.add("d-none");
            document.getElementById("changePasswordNav").classList.add("d-none");
        }
    }


    /* -------------------------------
       ëª¨ë‹¬ í‘œê¸° ê³µí†µ í•¨ìˆ˜
    --------------------------------*/
    function showModal(title, message, showLoginBtn = true) {
        document.getElementById("loginModalLabel").textContent = title;
        document.getElementById("modalMessage").textContent = message;

        const loginBtn = document.getElementById("goToLogin");

        if (showLoginBtn) loginBtn.classList.remove("d-none");
        else loginBtn.classList.add("d-none");

        const modalEl = document.getElementById("loginModal");
        const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
        modal.show();
    }


    /* -------------------------------
       ê´€ë¦¬ì ì ‘ê·¼ ì²´í¬ (í•µì‹¬)
    --------------------------------*/
    function checkAdminAccess(targetUrl) {
        const token = localStorage.getItem("token");
        const username = localStorage.getItem("username");
        const role = localStorage.getItem("role");

        if (!token || !username) {
            showModal("ë¡œê·¸ì¸ í•„ìš”", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", true);
            return;
        }

        if (role !== "ADMIN") {
            showModal("ì ‘ê·¼ ë¶ˆê°€", "ê´€ë¦¬ìë§Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë©”ë‰´ì…ë‹ˆë‹¤.", false);
            return;
        }

        window.location.href = targetUrl;
    }


    /* -------------------------------
       ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ í´ë¦­ ì²˜ë¦¬
    --------------------------------*/
    function bindMenuEvents() {
        const adminPages = ["menuLink", "stockLink", "dashLink", "customerLink"];
        const loginOnlyPages = ["orderLink", "listLink"];

        // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ ë©”ë‰´
        adminPages.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;

            el.addEventListener("click", function(e) {
                e.preventDefault();
                checkAdminAccess(el.getAttribute("href"));
            });
        });

        // ë¡œê·¸ì¸ë§Œ í•„ìš” ë©”ë‰´
        loginOnlyPages.forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;

            el.addEventListener("click", function(e) {
                e.preventDefault();

                const token = localStorage.getItem("token");
                const username = localStorage.getItem("username");

                if (!token || !username) {
                    showModal("ë¡œê·¸ì¸ í•„ìš”", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", true);
                    return;
                }

                window.location.href = el.getAttribute("href");
            });
        });
    }

    // Hero ì£¼ë¬¸ ë²„íŠ¼ë„ ë¡œê·¸ì¸ ì²´í¬ ì¶”ê°€
    document.addEventListener("DOMContentLoaded", () => {
        checkLoginStatus();
        bindMenuEvents();

        const heroOrderBtn = document.getElementById("heroOrderBtn");
        if (heroOrderBtn) {
            heroOrderBtn.addEventListener("click", (e) => {
                e.preventDefault();
                const token = localStorage.getItem("token");
                const username = localStorage.getItem("username");

                if (!token || !username) {
                    showModal("ë¡œê·¸ì¸ í•„ìš”", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", true);
                    return;
                }

                window.location.href = "/orders";
            });
        }
    });


    /* -------------------------------
       ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™ ë²„íŠ¼
    --------------------------------*/
    document.getElementById("goToLogin").addEventListener("click", () => {
        window.location.href = "/login";
    });


    /* -------------------------------
       ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
    --------------------------------*/
    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("token");
        localStorage.removeItem("username");
        localStorage.removeItem("role");
        window.location.href = "/";
    });
</script>

</body>
</html>
